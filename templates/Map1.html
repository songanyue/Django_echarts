<!DOCTYPE html>
{% load static %}
<html style="height:100%">
<head>
    <meta charset="UTF-8">
    <title>visualization</title>
    <link rel="stylesheet" href={% static "layui/css/layui.css" %}>
    <script type="text/javascript" src={% static "js/jquery-3.6.0.min.js" %}></script>
    <script type="text/javascript" src={% static "js/echarts.min.js" %}></script>
    <script type="text/javascript" src={% static "js/world.js" %}></script>
    <script type="text/javascript" src={% static "js/util.js" %}></script>
    <script type="text/javascript" src={% static "layui/layui.js" %}></script>
</head>
<style type="text/CSS">
    .layui-button {
        height: 3px;
        line-height: unset;
    }
</style>
<body style="height:98%; width:100%" onresize="resizeFresh()">
    <div style="height:100%; margin: auto; position: relative">
        <div id="head" style="height:15%; width:100%; z-index: 1; position: fixed; top: 0; left: auto">
            <h1 align="center" style="margin: 10px">战略经济对抗平台</h1>
            <div style="display: flex">
                <div class="layui-btn-container" style="margin-left: auto">
                    <button id="select_line0" class="layui-btn layui-btn-primary" style="margin-bottom: 0">
                        宏观经济数据<i class="layui-icon layui-icon-down layui-font-12"></i>
                    </button>
                </div>
                <form class="layui-form layui-form-pane" autocomplete="off" style="margin-right: auto">
                    <div class="layui-form-item" style="display: flex">
                        <label class="layui-form-label" style="width: 250px; text-align: right; border-style: none; background-color: unset">国家</label>
                        <div class="layui-input-block" style="margin-left: 0; margin-right: 50px">
                            <div class="layui-input" style="display: flex">
                                <div class="layui-slider-input-txt">
                                    <input id="search" type="text" placeholder="请选择" style="width: 100px">
                                </div>
                                <div class="layui-form-item" style="margin-left: 10px">
                                    <button id="search_bt" type="button" class="layui-btn layui-btn-primary" style="padding: 0 10px; height: 38px">
                                        <i class="layui-icon layui-icon-search"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div id="world" class="chart-container" style="width:100%; height:100%"></div>

        <div style="width:25%; height:40%; z-index: 1; position: fixed; bottom: 5%; left: 0">
            <div class="layui-btn-container" style="height:15%">
                <button id="select_line" class="layui-btn layui-btn-primary">
                    GDP(亿美元)<i class="layui-icon layui-icon-down layui-font-12"></i>
                </button>
            </div>
            <div id="china" class="chart-container" style="height:85%"></div>
        </div>
        <div style="width:25%; height:40%; z-index: 1; position: fixed; bottom: 5%; right: 0">
            <div class="layui-btn-container" style="height:15%">
                <button id="select_line2" class="layui-btn layui-btn-primary">GDP(亿美元)</button>
            </div>
            <div id="foreign" class="chart-container" style="height:85%"></div>
        </div>
    </div>

    <script>
        //窗口大小变化时候，进行刷新页面操作，防止样式混乱
        var x=window.innerWidth;
        function resizeFresh(){
            if(x!==window.innerWidth)
                location.reload();
        }
        var country_list = {{ country_list|safe }}
        var GDP_list = {{ GDP_list|safe }}
        var EPU_country = {{ EPU_country|safe }}

        function findKey(obj, value, compare = (a, b) => a === b) {
            return Object.keys(obj).find(k => compare(obj[k], value))
        }

        var china_name = country_list[1]
        var china_data = GDP_list[1]
        var china = echarts.init(document.getElementById('china'), 'white', {renderer: 'canvas'});
        var option_china = {
            "baseOption": {
                "series": [
                    {
                        "type": "line",
                        "name": china_name,
                        "connectNulls": false,
                        "xAxisIndex": 0,
                        "yAxisIndex": 0,
                        "symbolSize": 4,
                        "showSymbol": true,
                        "smooth": false,
                        "clip": true,
                        "step": false,
                        "data": china_data,
                        "hoverAnimation": true,
                        "label": {
                            "show": false,
                            "position": "top",
                            "margin": 8
                        },
                        "lineStyle": {
                            "show": true,
                            "width": 1,
                            "opacity": 1,
                            "curveness": 0,
                            "type": "solid"
                        },
                        "areaStyle": {
                            "opacity": 0
                        },
                        "zlevel": 0,
                        "z": 0
                    }
                ],
                "timeline": {
                    "axisType": "category",
                    "orient": "horizontal",
                    "autoPlay": false,
                    "controlPosition": "left",
                    "loop": true,
                    "rewind": false,
                    "show": false,
                    "inverse": false,
                    "left": "null",
                    "right": "0",
                    "top": "20",
                    "bottom": "20",
                    "width": "500",
                    "triggerEvent": true,
                    "label": {
                        "show": true,
                        "position": "top",
                        "color": "#fff",
                        "margin": 8
                    },
                    "data": country_list
                },
                "grid": [
                    {
                        "show": false,
                        "zlevel": 0,
                        "z": 2,
                        "left": 50,
                        "right": 10,
                        "top": 20,
                        "bottom": 50,
                        "containLabel": false,
                        "backgroundColor": "transparent",
                        "borderColor": "#ccc",
                        "borderWidth": 1
                    }
                ],
                "xAxis": [
                    {
                        "type": "category",
                        "show": true,
                        "scale": false,
                        "nameLocation": "end",
                        "nameGap": 15,
                        "gridIndex": 0,
                        "inverse": false,
                        "offset": 0,
                        "splitNumber": 5,
                        "minInterval": 0,
                        "splitLine": {
                            "show": false,
                            "lineStyle": {
                                "show": true,
                                "width": 1,
                                "opacity": 1,
                                "curveness": 0,
                                "type": "solid"
                            }
                        },
                        "data": china_data.map(function (item) {
                            return item[0]
                        })
                    }
                ],
                "yAxis": [
                    {
                        "show": true,
                        "scale": false,
                        "nameLocation": "end",
                        "nameGap": 15,
                        "gridIndex": 0,
                        "inverse": false,
                        "offset": 0,
                        "splitNumber": 5,
                        "minInterval": 0,
                        "splitLine": {
                            "show": true,
                            "lineStyle": {
                                "show": true,
                                "width": 1,
                                "opacity": 1,
                                "curveness": 0,
                                "type": "solid"
                            }
                        }
                    }
                ],
                "dataZoom": [
                    {
                        "type": 'slider',
                        "start": 75,
                        "end": 100,
                        "bottom": 0,
                        "height" : 25
                    }
                ]
            },
            "options": [
                {
                    "legend": [
                        {
                            "data": [
                                china_name
                            ],
                            "selected": {
                                china_name: true
                            },
                            "show": true,
                            "left": "46%",
                            "top": "0%",
                            "padding": 0,
                            "itemGap": 10,
                            "itemWidth": 25,
                            "itemHeight": 14
                        }
                    ],
                    "tooltip": {
                        "show": true,
                        "trigger": "item",
                        "triggerOn": "mousemove|click",
                        "axisPointer": {
                            "type": "line"
                        },
                        "showContent": true,
                        "alwaysShowContent": false,
                        "showDelay": 0,
                        "hideDelay": 100,
                        "textStyle": {
                            "fontSize": 14
                        },
                        "borderWidth": 0,
                        "padding": 5
                    },
                    "color": [
                        "#c23531",
                        "#2f4554",
                        "#61a0a8",
                        "#d48265",
                        "#749f83",
                        "#ca8622",
                        "#bda29a",
                        "#6e7074",
                        "#546570",
                        "#c4ccd3",
                        "#f05b72",
                        "#ef5b9c",
                        "#f47920",
                        "#905a3d",
                        "#fab27b",
                        "#2a5caa",
                        "#444693",
                        "#726930",
                        "#b2d235",
                        "#6d8346",
                        "#ac6767",
                        "#1d953f",
                        "#6950a1",
                        "#918597"
                    ]
                }
            ]
        };
        china.setOption(option_china);

        var foreign_name = country_list[0]
        var foreign_data = GDP_list[0]
        var foreign = echarts.init(document.getElementById('foreign'), 'white', {renderer: 'canvas'});
        var option_foreign = {
            "baseOption": {
                "series": [
                    {
                        "type": "line",
                        "name": foreign_name,
                        "connectNulls": false,
                        "xAxisIndex": 0,
                        "yAxisIndex": 0,
                        "symbolSize": 4,
                        "showSymbol": true,
                        "smooth": false,
                        "clip": true,
                        "step": false,
                        "data": foreign_data,
                        "hoverAnimation": true,
                        "label": {
                            "show": false,
                            "position": "top",
                            "margin": 8
                        },
                        "lineStyle": {
                            "show": true,
                            "width": 1,
                            "opacity": 1,
                            "curveness": 0,
                            "type": "solid"
                        },
                        "areaStyle": {
                            "opacity": 0
                        },
                        "zlevel": 0,
                        "z": 0
                    }
                ],
                "timeline": {
                    "axisType": "category",
                    "orient": "horizontal",
                    "autoPlay": false,
                    "controlPosition": "left",
                    "loop": true,
                    "rewind": false,
                    "show": false,
                    "inverse": false,
                    "left": "null",
                    "right": "0",
                    "top": "20",
                    "bottom": "20",
                    "width": "500",
                    "triggerEvent": true,
                    "label": {
                        "show": true,
                        "position": "top",
                        "color": "#fff",
                        "margin": 8
                    },
                    "data": country_list
                },
                "grid": [
                    {
                        "show": false,
                        "zlevel": 0,
                        "z": 2,
                        "left": 50,
                        "right": 10,
                        "top": 20,
                        "bottom": 50,
                        "containLabel": false,
                        "backgroundColor": "transparent",
                        "borderColor": "#ccc",
                        "borderWidth": 1
                    }
                ],
                "xAxis": [
                    {
                        "show": true,
                        "scale": false,
                        "nameLocation": "end",
                        "nameGap": 15,
                        "gridIndex": 0,
                        "inverse": false,
                        "offset": 0,
                        "splitNumber": 5,
                        "minInterval": 0,
                        "splitLine": {
                            "show": false,
                            "lineStyle": {
                                "show": true,
                                "width": 1,
                                "opacity": 1,
                                "curveness": 0,
                                "type": "solid"
                            }
                        },
                        "data": foreign_data.map(function (item) {
                            return item[0]
                        })
                    }
                ],
                "yAxis": [
                    {
                        "show": true,
                        "scale": false,
                        "nameLocation": "end",
                        "nameGap": 15,
                        "gridIndex": 0,
                        "inverse": false,
                        "offset": 0,
                        "splitNumber": 5,
                        "minInterval": 0,
                        "splitLine": {
                            "show": true,
                            "lineStyle": {
                                "show": true,
                                "width": 1,
                                "opacity": 1,
                                "curveness": 0,
                                "type": "solid"
                            }
                        }
                    }
                ],
                "dataZoom": [
                    {
                        "type": 'slider',
                        "start": 75,
                        "end": 100,
                        "bottom": 0,
                        "height" : 25
                    }
                ]
            },
            "options": [
                {
                    "legend": [
                        {
                            "data": [
                                foreign_name
                            ],
                            "selected": {
                                foreign_name: true
                            },
                            "show": true,
                            "left": "46%",
                            "top": "0%",
                            "padding": 0,
                            "itemGap": 10,
                            "itemWidth": 25,
                            "itemHeight": 14
                        }
                    ],
                    "tooltip": {
                        "show": true,
                        "trigger": "item",
                        "triggerOn": "mousemove|click",
                        "axisPointer": {
                            "type": "line"
                        },
                        "showContent": true,
                        "alwaysShowContent": false,
                        "showDelay": 0,
                        "hideDelay": 100,
                        "textStyle": {
                            "fontSize": 14
                        },
                        "borderWidth": 0,
                        "padding": 5
                    },
                    "color": [
                        "#c23531",
                        "#2f4554",
                        "#61a0a8",
                        "#d48265",
                        "#749f83",
                        "#ca8622",
                        "#bda29a",
                        "#6e7074",
                        "#546570",
                        "#c4ccd3",
                        "#f05b72",
                        "#ef5b9c",
                        "#f47920",
                        "#905a3d",
                        "#fab27b",
                        "#2a5caa",
                        "#444693",
                        "#726930",
                        "#b2d235",
                        "#6d8346",
                        "#ac6767",
                        "#1d953f",
                        "#6950a1",
                        "#918597"
                    ]
                }
            ]
        };
        foreign.setOption(option_foreign);

        var world = echarts.init(document.getElementById('world'), 'white', {renderer: 'canvas'});
        var option_world = {
            "baseOption": {
                "series": [
                    {
                        "type": "map",
                        "name": "GDP",
                        "label": {
                            "show": false,
                            "position": "top",
                            "margin": 8
                        },
                        "mapType": "world",
                        "data": [],
                        "roam": true,
                        "aspectScale": 0.75,
                        "nameProperty": "name",
                        "selectedMode": false,
                        "zoom": 1,
                        "layoutCenter": ['46%', '50%'],
                        "layoutSize": 750,
                        "nameMap": nameMap,
                        "mapValueCalculation": "sum",
                        "showLegendSymbol": false,
                        "emphasis": {},
                        "rippleEffect": {
                            "show": true,
                            "brushType": "stroke",
                            "scale": 2.5,
                            "period": 4
                        },
                        "xAxisIndex": 1,
                        "yAxisIndex": 1
                    }
                ],
                "grid": [
                    {
                        "show": false,
                        "zlevel": 0,
                        "z": 2,
                        "left": "10%",
                        "top": "10%",
                        "right": "10%",
                        "bottom": "10%",
                        "containLabel": false,
                        "backgroundColor": "transparent",
                        "borderColor": "#ccc",
                        "borderWidth": 1
                    }
                ]
            },
            "options": [
                {
                    "legend": [
                        {
                            "data": [
                                ""
                            ],
                            "selected": {
                                "GDP": true
                            },
                            "show": true,
                            "padding": 5,
                            "itemGap": 10,
                            "itemWidth": 25,
                            "itemHeight": 14
                        }
                    ],
                    "tooltip": {
                        "show": true,
                        "trigger": "item",
                        "triggerOn": "mousemove|click",
                        "axisPointer": {
                            "type": "line"
                        },
                        "showContent": true,
                        "alwaysShowContent": false,
                        "showDelay": 0,
                        "hideDelay": 100,
                        "textStyle": {
                            "fontSize": 14
                        },
                        "borderWidth": 0,
                        "padding": 5
                    },
                    "color": [
                        "#c23531",
                        "#2f4554",
                        "#61a0a8",
                        "#d48265",
                        "#749f83",
                        "#ca8622",
                        "#bda29a",
                        "#6e7074",
                        "#546570",
                        "#c4ccd3",
                        "#f05b72",
                        "#ef5b9c",
                        "#f47920",
                        "#905a3d",
                        "#fab27b",
                        "#2a5caa",
                        "#444693",
                        "#726930",
                        "#b2d235",
                        "#6d8346",
                        "#ac6767",
                        "#1d953f",
                        "#6950a1",
                        "#918597"
                    ]
                }
            ]
        };
        world.setOption(option_world);

        function setDetail(option) {
            var options = [];
            for (var i = 0; i <= country_list.length; i++) {
                var country = country_list[i]
                var detail = {
                    "legend": [
                        {
                            "data": [
                                country
                            ],
                            "selected": {
                                country: true
                            },
                            "show": true,
                            "left": "46%",
                            "top": "0%",
                            "padding": 0,
                            "itemGap": 10,
                            "itemWidth": 25,
                            "itemHeight": 14
                        }
                    ],
                    "tooltip": {
                        "show": true,
                        "trigger": "item",
                        "triggerOn": "mousemove|click",
                        "axisPointer": {
                            "type": "line"
                        },
                        "showContent": true,
                        "alwaysShowContent": false,
                        "showDelay": 0,
                        "hideDelay": 100,
                        "textStyle": {
                            "fontSize": 14
                        },
                        "borderWidth": 0,
                        "padding": 5
                    },
                    "color": [
                        "#c23531",
                        "#2f4554",
                        "#61a0a8",
                        "#d48265",
                        "#749f83",
                        "#ca8622",
                        "#bda29a",
                        "#6e7074",
                        "#546570",
                        "#c4ccd3",
                        "#f05b72",
                        "#ef5b9c",
                        "#f47920",
                        "#905a3d",
                        "#fab27b",
                        "#2a5caa",
                        "#444693",
                        "#726930",
                        "#b2d235",
                        "#6d8346",
                        "#ac6767",
                        "#1d953f",
                        "#6950a1",
                        "#918597"
                    ]
                };
                options.push(detail);
            }
            option.options = options;
        }

        var index = 0
        var selected = "美国"
        world.on('click', function(param) {
            selected = param.name
            $('#search').val(selected);
            index = country_list.indexOf(selected)
            $.ajax({
                url : "/select_Country_with_type/",
                type : "POST",
                data : {
                    'id': index + 1,
                    'type': document.getElementById("select_line").innerText
                },
                success: function (result) {
                    var obj = jQuery.parseJSON(result)
                    if(obj.error) {
                        alert(obj.error)
                        return false;
                    }
                    var country = obj.country
                    var data = obj.foreign_data

                    var foreign = echarts.init(document.getElementById('foreign'), 'white', {renderer: 'canvas'});
                    var option = {
                        "baseOption": {
                            "series": [
                                {
                                    "type": "line",
                                    "name": country,
                                    "connectNulls": false,
                                    "xAxisIndex": 0,
                                    "yAxisIndex": 0,
                                    "symbolSize": 4,
                                    "showSymbol": true,
                                    "smooth": false,
                                    "clip": true,
                                    "step": false,
                                    "data": data,
                                    "hoverAnimation": true,
                                    "label": {
                                        "show": false,
                                        "position": "top",
                                        "margin": 8
                                    },
                                    "lineStyle": {
                                        "show": true,
                                        "width": 1,
                                        "opacity": 1,
                                        "curveness": 0,
                                        "type": "solid"
                                    },
                                    "areaStyle": {
                                        "opacity": 0
                                    },
                                    "zlevel": 0,
                                    "z": 0
                                }
                            ],
                            "timeline": {
                                "axisType": "category",
                                "orient": "horizontal",
                                "autoPlay": false,
                                "controlPosition": "left",
                                "loop": true,
                                "rewind": false,
                                "show": false,
                                "inverse": false,
                                "currentIndex": index,
                                "left": "null",
                                "right": "0",
                                "top": "20",
                                "bottom": "20",
                                "width": "500",
                                "triggerEvent": true,
                                "label": {
                                    "show": true,
                                    "position": "top",
                                    "color": "#fff",
                                    "margin": 8
                                },
                                "data": country_list
                            },
                            "grid": [
                                {
                                    "show": false,
                                    "zlevel": 0,
                                    "z": 2,
                                    "left": 50,
                                    "right": 10,
                                    "top": 20,
                                    "bottom": 50,
                                    "containLabel": false,
                                    "backgroundColor": "transparent",
                                    "borderColor": "#ccc",
                                    "borderWidth": 1
                                }
                            ],
                            "xAxis": [
                                {
                                    "show": true,
                                    "scale": false,
                                    "nameLocation": "end",
                                    "nameGap": 15,
                                    "gridIndex": 0,
                                    "inverse": false,
                                    "offset": 0,
                                    "splitNumber": 5,
                                    "minInterval": 0,
                                    "splitLine": {
                                        "show": false,
                                        "lineStyle": {
                                            "show": true,
                                            "width": 1,
                                            "opacity": 1,
                                            "curveness": 0,
                                            "type": "solid"
                                        }
                                    },
                                    "data": data.map(function (item) {
                                        return item[0]
                                    })
                                }
                            ],
                            "yAxis": [
                                {
                                    "show": true,
                                    "scale": false,
                                    "nameLocation": "end",
                                    "nameGap": 15,
                                    "gridIndex": 0,
                                    "inverse": false,
                                    "offset": 0,
                                    "splitNumber": 5,
                                    "minInterval": 0,
                                    "splitLine": {
                                        "show": true,
                                        "lineStyle": {
                                            "show": true,
                                            "width": 1,
                                            "opacity": 1,
                                            "curveness": 0,
                                            "type": "solid"
                                        }
                                    }
                                }
                            ],
                            "dataZoom": [
                                {
                                    "type": 'slider',
                                    "start": 75,
                                    "end": 100,
                                    "bottom": 0,
                                    "height" : 25
                                }
                            ]
                        },
                        "options": []
                    };
                    setDetail(option);

                    foreign.setOption(option);
                    foreign.resize();
                }
            });
        });

        $('#search_bt').on('click', function () {
            selected = $('#search').val()
            index = country_list.indexOf(selected)
            $.ajax({
                url : "/select_Country_with_type/",
                type : "POST",
                data : {
                    'id': index + 1,
                    'type': document.getElementById("select_line").innerText
                },
                success: function (result) {
                    var obj = jQuery.parseJSON(result)
                    if(obj.error) {
                        alert(obj.error)
                        return
                    }
                    var country = obj.country
                    var data = obj.foreign_data

                    var foreign = echarts.init(document.getElementById('foreign'), 'white', {renderer: 'canvas'});
                    var option = {
                        "baseOption": {
                            "series": [
                                {
                                    "type": "line",
                                    "name": country,
                                    "connectNulls": false,
                                    "xAxisIndex": 0,
                                    "yAxisIndex": 0,
                                    "symbolSize": 4,
                                    "showSymbol": true,
                                    "smooth": false,
                                    "clip": true,
                                    "step": false,
                                    "data": data,
                                    "hoverAnimation": true,
                                    "label": {
                                        "show": false,
                                        "position": "top",
                                        "margin": 8
                                    },
                                    "lineStyle": {
                                        "show": true,
                                        "width": 1,
                                        "opacity": 1,
                                        "curveness": 0,
                                        "type": "solid"
                                    },
                                    "areaStyle": {
                                        "opacity": 0
                                    },
                                    "zlevel": 0,
                                    "z": 0
                                }
                            ],
                            "timeline": {
                                "axisType": "category",
                                "orient": "horizontal",
                                "autoPlay": false,
                                "controlPosition": "left",
                                "loop": true,
                                "rewind": false,
                                "show": false,
                                "inverse": false,
                                "currentIndex": index,
                                "left": "null",
                                "right": "0",
                                "top": "20",
                                "bottom": "20",
                                "width": "500",
                                "triggerEvent": true,
                                "label": {
                                    "show": true,
                                    "position": "top",
                                    "color": "#fff",
                                    "margin": 8
                                },
                                "data": country_list
                            },
                            "grid": [
                                {
                                    "show": false,
                                    "zlevel": 0,
                                    "z": 2,
                                    "left": 50,
                                    "right": 10,
                                    "top": 20,
                                    "bottom": 50,
                                    "containLabel": false,
                                    "backgroundColor": "transparent",
                                    "borderColor": "#ccc",
                                    "borderWidth": 1
                                }
                            ],
                            "xAxis": [
                                {
                                    "show": true,
                                    "scale": false,
                                    "nameLocation": "end",
                                    "nameGap": 15,
                                    "gridIndex": 0,
                                    "inverse": false,
                                    "offset": 0,
                                    "splitNumber": 5,
                                    "minInterval": 0,
                                    "splitLine": {
                                        "show": false,
                                        "lineStyle": {
                                            "show": true,
                                            "width": 1,
                                            "opacity": 1,
                                            "curveness": 0,
                                            "type": "solid"
                                        }
                                    },
                                    "data": data.map(function (item) {
                                        return item[0]
                                    })
                                }
                            ],
                            "yAxis": [
                                {
                                    "show": true,
                                    "scale": false,
                                    "nameLocation": "end",
                                    "nameGap": 15,
                                    "gridIndex": 0,
                                    "inverse": false,
                                    "offset": 0,
                                    "splitNumber": 5,
                                    "minInterval": 0,
                                    "splitLine": {
                                        "show": true,
                                        "lineStyle": {
                                            "show": true,
                                            "width": 1,
                                            "opacity": 1,
                                            "curveness": 0,
                                            "type": "solid"
                                        }
                                    }
                                }
                            ],
                            "dataZoom": [
                                {
                                    "type": 'slider',
                                    "start": 75,
                                    "end": 100,
                                    "bottom": 0,
                                    "height" : 30
                                }
                            ]
                        },
                        "options": []
                    };
                    setDetail(option);

                    foreign.setOption(option);
                    foreign.resize();
                }
            });
        })

        layui.use(['dropdown'], function() {
            var dropdown = layui.dropdown;
            dropdown.render({
                elem: '#select_line0',
                trigger: 'mousedown',
                data: [
                    {
                        id: '../',
                        title: '总览',
                    }, {
                        id: '../map1',
                        title: '宏观经济数据',
                    }, {
                        id: '../map2',
                        title: '政策波动性',
                    }, {
                        id: '../map3D',
                        title: '国家关联关系',
                    }, {
                        id: '../aid',
                        title: '对外援助',
                    }
                ],
                click: function(param) {
                    window.location.href = param.id;
                }
            });
        });

        layui.use(['dropdown'], function() {
            var dropdown = layui.dropdown;
            dropdown.render({
                elem: '#select_line',
                trigger: 'mousedown',
                data: [
                {
                    title: '国民账户',
                    child: [{
                        id: 'GDP(亿美元)',
                        title: 'GDP(亿美元)'
                    }, {
                        id: 'GDP增长率(%)',
                        title: 'GDP增长率(%)'
                    }, {
                        id: '人均GDP(美元)',
                        title: '人均GDP(美元)'
                    }, {
                        id: '总投资占比(%)',
                        title: '总投资占比(%)'
                    }]
                }, {
                    title: '货币',
                    child: [{
                        id: '通货膨胀率(%)',
                        title: '通货膨胀率(%)'
                    }]
                }, {
                    title: '贸易',
                    child: [{
                        id: '货物和服务进口量(%)',
                        title: '货物和服务进口量(%)'
                    }, {
                        id: '货物和服务出口量(%)',
                        title: '货物和服务出口量(%)'
                    }]
                }, {
                    title: '人口',
                    child: [{
                        id: '失业率(%)',
                        title: '失业率(%)'
                    }, {
                        id: '人口(百万)',
                        title: '人口(百万)'
                    }]
                }, {
                    title: '政府财政',
                    child: [{
                        id: '政府收入占比(%)',
                        title: '政府收入占比(%)'
                    }, {
                        id: '政府支出占比(%)',
                        title: '政府支出占比(%)'
                    }]
                }],
                click: function(param) {
                    document.getElementById("select_line").innerHTML = param.title + '<i class="layui-icon layui-icon-down layui-font-12"></i>';
                    document.getElementById("select_line2").innerHTML = param.title;
                    $.ajax({
                        url : "/select_Country_with_type/",
                        type : "POST",
                        data : {
                            'id': index + 1,
                            'type': param.id
                        },
                        success: function (result) {  //获取后台处理后传过来的result
                            var obj = jQuery.parseJSON(result)
                            if(obj.error) {
                                alert(obj.error)
                                return false;
                            }
                            var country = obj.country
                            var china_data = obj.china_data
                            var foreign_data = obj.foreign_data
                            var china = echarts.init(document.getElementById('china'), 'white', {renderer: 'canvas'});
                            var option_china = {
                                "baseOption": {
                                    "series": [
                                        {
                                            "type": "line",
                                            "name": country_list[1],
                                            "connectNulls": false,
                                            "xAxisIndex": 0,
                                            "yAxisIndex": 0,
                                            "symbolSize": 4,
                                            "showSymbol": true,
                                            "smooth": false,
                                            "clip": true,
                                            "step": false,
                                            "data": china_data,
                                            "hoverAnimation": true,
                                            "label": {
                                                "show": false,
                                                "position": "top",
                                                "margin": 8
                                            },
                                            "lineStyle": {
                                                "show": true,
                                                "width": 1,
                                                "opacity": 1,
                                                "curveness": 0,
                                                "type": "solid"
                                            },
                                            "areaStyle": {
                                                "opacity": 0
                                            },
                                            "zlevel": 0,
                                            "z": 0
                                        }
                                    ],
                                    "timeline": {
                                        "axisType": "category",
                                        "orient": "horizontal",
                                        "autoPlay": false,
                                        "controlPosition": "left",
                                        "loop": true,
                                        "rewind": false,
                                        "show": false,
                                        "inverse": false,
                                        "left": "null",
                                        "right": "0",
                                        "top": "20",
                                        "bottom": "20",
                                        "width": "500",
                                        "triggerEvent": true,
                                        "label": {
                                            "show": true,
                                            "position": "top",
                                            "color": "#fff",
                                            "margin": 8
                                        },
                                        "data": country_list
                                    },
                                    "grid": [
                                        {
                                            "show": false,
                                            "zlevel": 0,
                                            "z": 2,
                                            "left": 50,
                                            "right": 10,
                                            "top": 20,
                                            "bottom": 50,
                                            "containLabel": false,
                                            "backgroundColor": "transparent",
                                            "borderColor": "#ccc",
                                            "borderWidth": 1
                                        }
                                    ],
                                    "xAxis": [
                                        {
                                            "show": true,
                                            "scale": false,
                                            "nameLocation": "end",
                                            "nameGap": 15,
                                            "gridIndex": 0,
                                            "inverse": false,
                                            "offset": 0,
                                            "splitNumber": 5,
                                            "minInterval": 0,
                                            "splitLine": {
                                                "show": false,
                                                "lineStyle": {
                                                    "show": true,
                                                    "width": 1,
                                                    "opacity": 1,
                                                    "curveness": 0,
                                                    "type": "solid"
                                                }
                                            },
                                            "data": china_data.map(function (item) {
                                                return item[0]
                                            })
                                        }
                                    ],
                                    "yAxis": [
                                        {
                                            "show": true,
                                            "scale": false,
                                            "nameLocation": "end",
                                            "nameGap": 15,
                                            "gridIndex": 0,
                                            "inverse": false,
                                            "offset": 0,
                                            "splitNumber": 5,
                                            "minInterval": 0,
                                            "splitLine": {
                                                "show": true,
                                                "lineStyle": {
                                                    "show": true,
                                                    "width": 1,
                                                    "opacity": 1,
                                                    "curveness": 0,
                                                    "type": "solid"
                                                }
                                            }
                                        }
                                    ],
                                    "dataZoom": [
                                        {
                                            "type": 'slider',
                                            "start": 75,
                                            "end": 100,
                                            "bottom": 0,
                                            "height" : 25
                                        }
                                    ]
                                },
                                "options": [
                                    {
                                        "legend": [
                                            {
                                                "data": [
                                                    china_name
                                                ],
                                                "selected": {
                                                    china_name: true
                                                },
                                                "show": true,
                                                "left": "46%",
                                                "top": "0%",
                                                "padding": 0,
                                                "itemGap": 10,
                                                "itemWidth": 25,
                                                "itemHeight": 14
                                            }
                                        ],
                                        "tooltip": {
                                            "show": true,
                                            "trigger": "item",
                                            "triggerOn": "mousemove|click",
                                            "axisPointer": {
                                                "type": "line"
                                            },
                                            "showContent": true,
                                            "alwaysShowContent": false,
                                            "showDelay": 0,
                                            "hideDelay": 100,
                                            "textStyle": {
                                                "fontSize": 14
                                            },
                                            "borderWidth": 0,
                                            "padding": 5
                                        },
                                        "color": [
                                            "#c23531",
                                            "#2f4554",
                                            "#61a0a8",
                                            "#d48265",
                                            "#749f83",
                                            "#ca8622",
                                            "#bda29a",
                                            "#6e7074",
                                            "#546570",
                                            "#c4ccd3",
                                            "#f05b72",
                                            "#ef5b9c",
                                            "#f47920",
                                            "#905a3d",
                                            "#fab27b",
                                            "#2a5caa",
                                            "#444693",
                                            "#726930",
                                            "#b2d235",
                                            "#6d8346",
                                            "#ac6767",
                                            "#1d953f",
                                            "#6950a1",
                                            "#918597"
                                        ]
                                    }
                                ]
                            };
                            china.setOption(option_china);

                            var foreign = echarts.init(document.getElementById('foreign'), 'white', {renderer: 'canvas'});
                            var foreign_option = {
                                "baseOption": {
                                    "series": [
                                        {
                                            "type": "line",
                                            "name": country,
                                            "connectNulls": false,
                                            "xAxisIndex": 0,
                                            "yAxisIndex": 0,
                                            "symbolSize": 4,
                                            "showSymbol": true,
                                            "smooth": false,
                                            "clip": true,
                                            "step": false,
                                            "data": foreign_data,
                                            "hoverAnimation": true,
                                            "label": {
                                                "show": false,
                                                "position": "top",
                                                "margin": 8
                                            },
                                            "lineStyle": {
                                                "show": true,
                                                "width": 1,
                                                "opacity": 1,
                                                "curveness": 0,
                                                "type": "solid"
                                            },
                                            "areaStyle": {
                                                "opacity": 0
                                            },
                                            "zlevel": 0,
                                            "z": 0
                                        }
                                    ],
                                    "timeline": {
                                        "axisType": "category",
                                        "orient": "horizontal",
                                        "autoPlay": false,
                                        "controlPosition": "left",
                                        "loop": true,
                                        "rewind": false,
                                        "show": false,
                                        "inverse": false,
                                        "left": "null",
                                        "right": "0",
                                        "top": "20",
                                        "bottom": "20",
                                        "width": "500",
                                        "triggerEvent": true,
                                        "label": {
                                            "show": true,
                                            "position": "top",
                                            "color": "#fff",
                                            "margin": 8
                                        },
                                        "data": country_list
                                    },
                                    "grid": [
                                        {
                                            "show": false,
                                            "zlevel": 0,
                                            "z": 2,
                                            "left": 50,
                                            "right": 10,
                                            "top": 20,
                                            "bottom": 50,
                                            "containLabel": false,
                                            "backgroundColor": "transparent",
                                            "borderColor": "#ccc",
                                            "borderWidth": 1
                                        }
                                    ],
                                    "xAxis": [
                                        {
                                            "show": true,
                                            "scale": false,
                                            "nameLocation": "end",
                                            "nameGap": 15,
                                            "gridIndex": 0,
                                            "inverse": false,
                                            "offset": 0,
                                            "splitNumber": 5,
                                            "minInterval": 0,
                                            "splitLine": {
                                                "show": false,
                                                "lineStyle": {
                                                    "show": true,
                                                    "width": 1,
                                                    "opacity": 1,
                                                    "curveness": 0,
                                                    "type": "solid"
                                                }
                                            },
                                            "data": foreign_data.map(function (item) {
                                                return item[0]
                                            })
                                        }
                                    ],
                                    "yAxis": [
                                        {
                                            "show": true,
                                            "scale": false,
                                            "nameLocation": "end",
                                            "nameGap": 15,
                                            "gridIndex": 0,
                                            "inverse": false,
                                            "offset": 0,
                                            "splitNumber": 5,
                                            "minInterval": 0,
                                            "splitLine": {
                                                "show": true,
                                                "lineStyle": {
                                                    "show": true,
                                                    "width": 1,
                                                    "opacity": 1,
                                                    "curveness": 0,
                                                    "type": "solid"
                                                }
                                            }
                                        }
                                    ],
                                    "dataZoom": [
                                        {
                                            "type": 'slider',
                                            "start": 75,
                                            "end": 100,
                                            "bottom": 0,
                                            "height" : 25
                                        }
                                    ]
                                },
                                "options": []
                            };
                            setDetail(foreign_option);
                            foreign.setOption(foreign_option);
                            foreign.resize();
                        }
                    });
                }
            });
        });

    </script>
    <script>
	     //窗口大小变化时候，进行刷新页面操作，防止样式混乱
         var x=window.innerWidth;
         function resizeFresh(){
             if(x!==window.innerWidth)
                 location.reload();
         }
	</script>
</body>
</html>